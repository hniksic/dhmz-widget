# HAProxy CORS proxy for DHMZ weather data
# This proxies requests to vrijeme.hr and adds CORS headers

frontend cors_proxy
    bind *:8080
    mode http

    # Handle CORS preflight (OPTIONS) requests
    http-request return status 204 content-type "text/plain" if METH_OPTIONS

    # Add CORS headers to all responses
    http-response set-header Access-Control-Allow-Origin "*"
    http-response set-header Access-Control-Allow-Methods "GET, OPTIONS"
    http-response set-header Access-Control-Allow-Headers "Content-Type"

    default_backend dhmz_backend

backend dhmz_backend
    mode http
    server dhmz vrijeme.hr:443 ssl verify none

    # Rewrite Host header for the upstream
    http-request set-header Host vrijeme.hr

    # Only allow specific paths (security)
    http-request deny unless { path /hrvatska1_n.xml }
